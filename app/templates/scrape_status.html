<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Daten werden gesammelt...</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
<style>
    body {
        margin: 0;
        padding: 0;
        font-family: 'Roboto', sans-serif;
        background-color: #f4f7f6;
    }

    .navbar {
        background-color: #008cba;
        padding: 15px;
        color: white;
        font-size: 24px;
        text-align: center;
    }

    .container {
        display: flex;
        height: calc(100vh - 60px); /* Gesamte Höhe minus Navbar-Höhe */
        justify-content: space-between;
    }

    .links-container {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        box-sizing: border-box;
        background-color: #ffffff;
        border-right: 1px solid #e0e0e0;
    }

    .screenshot-container {
        flex: 0.3;
        padding: 20px;
        background-color: #ffffff;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        border-left: 1px solid #e0e0e0;
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    tbody td {
        padding: 8px 12px;
        font-size: 14px;
        vertical-align: top;
    }

    .toggle-btn {
        cursor: pointer;
        margin-right: 5px;
    }

    .toggle-icon {
        transition: transform 0.2s ease;
    }

    .rotated {
        transform: rotate(90deg);
    }

    .child-row {
        display: none;
    }

    .visible {
        display: table-row;
    }

    a.link-item {
        color: #008cba;
        text-decoration: none;
    }

    a.link-item:hover {
        text-decoration: underline;
    }

    input[type="checkbox"] {
        transform: scale(1.2);
        cursor: pointer;
    }

    /* Scrollbar Styles */
    .links-container::-webkit-scrollbar {
        width: 8px;
    }

    .links-container::-webkit-scrollbar-thumb {
        background-color: #cccccc;
        border-radius: 4px;
    }

    /* Screenshot Button */
    #screenshot-button {
        background-color: #27ae60;
        color: white;
        border: none;
        padding: 12px 20px;
        font-size: 16px;
        cursor: pointer;
        border-radius: 5px;
        text-align: center;
        margin-top: 20px;
        width: 100%;
        transition: background-color 0.3s ease;
    }

    #screenshot-button:hover {
        background-color: #1e8449;
    }
</style>
</head>
<body>

    <div class="loading-container">
        <div class="loader"></div>
        <h1>Wir sammeln deine gesuchten Daten!</h1>
        <p>Bitte hab einen Moment Geduld. Wir sind dabei, alle Informationen für dich zusammenzustellen.</p>
        <p class="error" style="display: none;">Ups! Etwas ist schiefgelaufen. Bitte versuche es später erneut.</p>
    </div>

    <script>
        async function checkStatus() {
            try {
                const response = await fetch(`/get_status/{{ task_id }}`);
                if (!response.ok) {
                    throw new Error('Fehlerhafte Antwort vom Server');
                }

                const data = await response.json();
                console.log('Status:', data.status);

                if (data.status === "completed") {
                    window.location.href = `/scrape_result/{{ task_id }}`;
                } else if (data.status === "failed") {
                    const errorMsg = document.querySelector('.error');
                    errorMsg.style.display = 'block';
                    errorMsg.innerText = "Ups! Beim Sammeln der Daten ist ein Fehler aufgetreten.";
                } else {
                    setTimeout(checkStatus, 2000);  // Alle 2 Sekunden Status überprüfen
                }
            } catch (error) {
                console.error('Fehler beim Abrufen des Status:', error);
                const errorMsg = document.querySelector('.error');
                errorMsg.style.display = 'block';
                errorMsg.innerText = "Ups! Beim Verbinden ist ein Fehler aufgetreten. Bitte versuche es später erneut.";
            }
        }

        // Initialen Status-Check starten
        checkStatus();
    </script>

</body>
</html>
